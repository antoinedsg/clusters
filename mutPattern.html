<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="style.css">
	<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> 
	<!-- Import math.js to perform maths operations in JS -->
	<script src="math.js" type="text/javascript"></script>
	<style type="text/css">
		#mutation-matrix {
			position: relative;
			display: inline-block;
			padding: 5px;
			border: 1px solid grey;
			background-color: #f2f2f2;
		}



		#mutation-matrix .cell {
			width: 20px;
			height: 20px;
			border: 1px solid grey;
			background-color: white;
		}

		#mutation-matrix .cell-on {
			width: 20px;
			height: 20px;
			border: 1px solid grey;
  			background-color: grey;
	}

/* Popup container */
.popup {
  position: relative;
  display: block;
  cursor: pointer;
  width: fit-content; 
}

/* The actual popup (appears on top) */
.popup .popuptext {
	display: none;
 /* visibility: hidden; */
}

/* Popup arrow */
.popup .popuptext::after {
  content: "";

}

/* Toggle this class when clicking on the popup container (hide and show the popup) */

	</style>
</head>
<body>
  <header>
    <a href="home.html"><img style="width: 80px" src="logo.png"></a>
    <h3 >Visual Cluster Algebras</h3>
    <nav>
      <ul>
      <li ><a href="mutPattern.html">Mutation patterns</a></li>
      <li ><a href="greedy.html">Greedy elements</a></li>
      <li ><a href="dVectorFan.html">Denominator vector fan</a></li>
    </ul>
    </nav>
  </header>
	<div class="popup">
		<button onclick="createGrid()">Choose matrix size</button>
		<div class="popuptext" id="mutation-matrix" style="display: none">
			
			<table>
				<thead><div style="display: inline-block; float: left;" id="tableHead"></div><div style="display: inline-block; float: right" onclick="closePopup()">Close</div></thead><br>
				<tr>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="0"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="1"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="2"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="3"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="4"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="5"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="6"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="7"></th>
				</tr>
				<tr>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="8"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="9"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="10"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="11"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="12"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="13"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="14"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="15"></th>
				</tr>
				<tr>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="16"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="17"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="18"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="19"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="20"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="21"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="22"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="23"></th>
				</tr>
				<tr>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="24"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="25"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="26"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="27"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="28"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="29"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="30"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="31"></th>
				</tr>
								<tr>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="32"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="33"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="34"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="35"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="36"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="37"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="38"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="39"></th>
				</tr>
				<tr>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="40"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="41"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="42"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="43"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="44"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="45"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="46"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="47"></th>
				</tr>
				<tr>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="48"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="49"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="50"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="51"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="52"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="53"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="54"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="55"></th>
				</tr>
				<tr>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="56"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="57"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="58"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="59"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="60"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="61"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="62"></th>
					<th class="cell" onmouseover="hoverSelect(this.id)" 
					onmouseout="hoverOff(this.id)" onclick="createEmptyMat(this.id)" id="63"></th>
				</tr>
			</table>
		</div>
	</div>

	<form id="inputField">
		<div id="tableContainer"></div>
		<input type="button" onclick="createMutationMatrix()" value="Create mutation matrix">
	</form>


	<div id="initialMatrix"></div>
	<div id="mutationButtons"></div>

	

	

	<script type="text/javascript">
		function closePopup() {
			var popup = document.getElementById("mutation-matrix");
  			popup.style.display = "none";
		}
		// Add event listener to button

		function createGrid() {
			var popup = document.getElementById("mutation-matrix");
  			popup.style.display = "block";
		}


		function hoverSelect(n) {
			var rownum = Math.floor(n/8);
			var colnum = n%8;
			document.getElementById("tableHead").innerHTML = "Matrix of size " + (rownum+1) + "x" + (colnum+1);
			for (let i=0; i<=rownum; i++) {
				for (let j=0; j <= colnum; j++) {
					var m = i*8+j;
					cell = document.getElementById(m);
					cell.className = "cell-on";
					
				}
			}
		}

		function hoverOff(n) {
			var rownum = Math.floor(n/8);
			var colnum = n%8;
			for (let i=0; i<8; i++) {
				for (let j=0; j <8; j++) {
					var m = i*8+j;
					cell = document.getElementById(m);
					if (i< rownum && j>= colnum) {
						cell.className = "cell";
					}
					else if (i >= rownum){
						cell.className = "cell";
					}	
				}
			}
		}


		function generateTable(n, m) {
			closePopup();
			var tableContainer = document.getElementById("tableContainer");
			tableContainer.innerHTML = "";
		  // Create the table element
			var table = document.createElement("table");

		  // Create rows and cells
		  	for (var i = 0; i < n; i++) {
		    	var row = table.insertRow();
			    for (var j = 0; j < m; j++) {
			      var cell = row.insertCell();
			      cell.innerHTML = '<input type="text" maxlength="4" size="3"/>';
			    }
		  	}

		  // Append the table to the table container
		  	tableContainer.appendChild(table);
		  	table.setAttribute("id", "mutMatrix");
		}

		function createEmptyMat(n) {
			let rownum = Math.floor(n/8)+1;
			let colnum = n%8+1;
			generateTable(rownum, colnum);
		}

		function arrayToMatrix(array,rownum,tagById) {
		// Clear the current div
		document.getElementById(tagById).innerHTML = "";
			let colnum = (array.length) / (rownum);
			document.getElementById(tagById).innerHTML += "\\( \\begin{pmatrix}";
			for (var i = 0;i < rownum; i++) {
				for (var j = 0; j < colnum; j++) {
					document.getElementById(tagById).innerHTML += array[i*colnum + j];
					if (j != colnum-1) {
						document.getElementById(tagById).innerHTML += "&";
					}
				}
				if (i != rownum-1) {
					document.getElementById(tagById).innerHTML += '\\\\';
				}
			}
			document.getElementById(tagById).innerHTML += "\\end{pmatrix}\\)";
		}

		// cellsInitialMat
		var cellsInitialMat;
		var rownumInitialMat;

		function createMutationMatrix() {
			// Clear any previous mutation matrix / mutation buttons
			document.getElementById("initialMatrix").innerHTML = "";
			document.getElementById("mutationButtons").innerHTML = "";

			// Function to convert the user input of initial mutation matrix into an array
			function callme() {
			  let result = Array.prototype.map.call(cells, function(e) {
			    return e.value;
			  });
			  return result;
			}

			// Retrieve the content of each <input> in tableContainer, i.e. the content of each cell
			// let cells = document.querySelectorAll('#tableContainer input');
			
			let cells = document.querySelectorAll('#tableContainer input');
			let cellsArray = callme();
			cellsInitialMat = cellsArray;

			// Retrieve all the rows in tableContainer.
			let rows = document.querySelectorAll('#tableContainer tr');
			rownumInitialMat = rows.length;

			// Create MathJax rendition of initial mutation matrix in the <div id="initialMatrix">
			arrayToMatrix(cellsArray,rows.length,'initialMatrix');
			// Ask MathJax to render the newly created code in LaTeX
			MathJax.typeset([initialMatrix]);

			mutationButtons = document.getElementById("mutationButtons");
			// Create a mutation button for each column number
			for (let i = 1; i <= (cellsArray.length)/(rows.length); i++) {
				let button = document.createElement("button");
				let mutationButtonNum = i + "mutButton";
				button.setAttribute("id", mutationButtonNum);
				button.setAttribute("onclick", "mutateMat(this.id)");
				button.innerHTML = "\\( \\mu_" + i + "\\)";
				mutationButtons.appendChild(button);
			}
			MathJax.typeset([mutationButtons]);
		}

		function mutateMat(id) {
			let direction = id.substring(0,1);
			cellsInitialMat = mutation(cellsInitialMat,rownumInitialMat,(cellsInitialMat.length)/rownumInitialMat,direction);
			arrayToMatrix(cellsInitialMat,rownumInitialMat,'initialMatrix');
			MathJax.typeset([initialMatrix]);
		}

		function maxPart(a) {
			if (a >0) {
				return a;
			}
			else {
				return 0;
			}
		}

		function mutation(matrix,rows,cols,direction) {
			// Declare a new matrix (the RHS guarantees the copy is a deep copy)
			let newMatrix = JSON.parse(JSON.stringify(matrix));
			// Matrix mutation formulas:
			for (i = 0; i < rows; i++) {
				for (j = 0; j < cols; j++) {
					if (i == (direction-1) || j == (direction-1)) {
						newMatrix[i*cols + j] = (-1)*matrix[i*cols + j];
					}
					else {
						newMatrix[i*cols + j] = parseFloat(matrix[i*cols + j]) + parseFloat(maxPart(matrix[i*cols + (direction -1)]))*parseFloat(maxPart(matrix[(direction-1)*cols + j])) - parseFloat(maxPart(-matrix[i*cols + (direction -1)]))*parseFloat(maxPart(-matrix[(direction-1)*cols + j]));

					}
				}
			}
			return newMatrix;
		}
		
	</script>
</body>
</html>


